{% extends 'index.html' %}
{% block content%}
	<div id='trip-info'>
		<h1 id='park-name'></h1>
		<h1 id='park-city-state'></h1>
		<h1 id='avg-temp'></h1>
		<h1 id='min-temp'></h1>
		<h1 id='max-temp'></h1>
		<h1 id='avg-rain'></h1>

		<img id='img1' src="" alt="park image one" style="visibility:hidden">
		<img id='img2' src="" alt="park image two" style="visibility:hidden">
		<img id='img3'src="" alt="park image three" style="visibility:hidden">
		<img id='img4' src="" alt="park image four" style="visibility:hidden">
	</div>

{% endblock content %}
{% block scripts %}
<script>
	
	let parks = "{{ parks }}";
	parks = parks.replaceAll("&#39;", "\'");
	parks = parks.replaceAll("&#34;", "\"");
	parks = parks.substr(1).slice(0, -1);
	parks = JSON.parse(parks);
	let month = document.getElementById('month').innerHTML
	
	parks.forEach(function (park){
		let popupText = `${park.park.name} <br> ${park.park.city}, ${park.park.state} <br> ${park.park.description}`
		let marker = new mapboxgl.Marker()
			.setLngLat([parseFloat(park.park.longitude),parseFloat(park.park.latitude)])
			.setPopup(new mapboxgl.Popup().setHTML(popupText))
			.addTo(map)
			map.flyTo({
			center: [parseFloat(park.park.longitude),parseFloat(park.park.latitude)]
			});

			marker.getElement().addEventListener('click', () => {
				//call fetch_data to get Park data, pictures, weather
				park_id = park.park.id
				// let trip = fetch_data(park_id,month)
				// console.log(trip)
				url = `http://127.0.0.1:5000/park_info/${park_id}/${month}` //api/db url here
				fetch(url)
					.then( (response) => {
						console.log(response) // logging response from the server
						// extract JSON
						return response.json()
					})
					.then( function(data) {
						console.log(data)
						let name = document.getElementById("park-name")
						name.innerHTML = JSON.stringify(data['park']['park_name']).replaceAll("\"","")

						let city_state = document.getElementById("park-city-state")
						city_state.innerHTML = JSON.stringify(data['park']['city'] + ', ' + data['park']['state']).replaceAll("\"","")

						let avg_temp = document.getElementById("avg-temp")
						avg_temp.innerHTML = `average temp: ${data['park']['avg_temp']} &#8457;`

						let max_temp = document.getElementById("max-temp")
						max_temp.innerHTML = `max temp: ${data['park']['max_temp']} &#8457;`

						let min_temp = document.getElementById("min-temp")
						min_temp.innerHTML = `min temp: ${data['park']['min_temp']} &#8457;`

						let avg_rain = document.getElementById("avg-rain")
						avg_rain.innerHTML = `average rainfall: ${ data['park']['precipiation']} inches`

						let image1URL = document.getElementById("img1")
						image1URL.style.visibility="visible"
						image1URL.src = data['park']['image_1'].replaceAll("\"","")

						let image2URL = document.getElementById("img2")
						image2URL.style.visibility="visible"
						image2URL.src = data['park']['image_2'].replaceAll("\"","")

						let image3URL = document.getElementById("img3")
						image3URL.style.visibility="visible"
						image3URL.src = data['park']['image_3'].replaceAll("\"","")

						// TODO image 4 is coming back NULL
						// let image4URL = document.getElementById("img4")
						// image4URL.style.visibility="visible"
						// image4URL.src = data['park']['image_4'].replaceAll("\"","")

					}) //if issues connecting to API error displays
					.catch( error => {
						console.log(error)
						alert('ERROR, VIEW CONSOLE FOR MORE DETAILS')
					})

			})// end of event listener

        }) //end of for each
</script>
{% endblock scripts %}
