{% extends 'index.html' %}
{% block content%}
	<h1 id='trip-info'></h1>
{% endblock content %}
{% block scripts %}
<script>
	
	let parks = "{{ parks }}";
	parks = parks.replaceAll("&#39;", "\'");
	parks = parks.replaceAll("&#34;", "\"");
	parks = parks.substr(1).slice(0, -1);
	parks = JSON.parse(parks);
	let month = document.getElementById('month').innerHTML
	let tripDisplay = document.getElementById("trip-info")
	
	parks.forEach(function (park){
		let popupText = `${park.park.name} <br> ${park.park.city}, ${park.park.state} <br> ${park.park.description}`
		let marker = new mapboxgl.Marker()
			.setLngLat([parseFloat(park.park.longitude),parseFloat(park.park.latitude)])
			.setPopup(new mapboxgl.Popup().setHTML(popupText))
			.addTo(map)
			map.flyTo({
			center: [parseFloat(park.park.longitude),parseFloat(park.park.latitude)]
			});

			marker.getElement().addEventListener('click', () => {
				//call fetch_data to get Park data, pictures, weather
				park_id = park.park.id
				// let trip = fetch_data(park_id,month)
				// console.log(trip)
				url = `http://127.0.0.1:5000/park_info/${park_id}/${month}` //api/db url here
				fetch(url)
					.then( (response) => {
						console.log(response) // logging response from the server
						// extract JSON
						return response.json()
					})
					.then( function(data) {

						let trip = data['park']['park_name']
						tripDisplay.innerHTML = JSON.stringify(trip);

		
					}) //if issues connecting to API error displays
					.catch( error => {
						console.log(error)
						alert('ERROR, VIEW CONSOLE FOR MORE DETAILS')
					})

			})// end of event listener

        }) //end of for each
</script>
{% endblock scripts %}
