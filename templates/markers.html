{% extends 'index.html' %}
{% block head %}
  {{ super() }}
  <style type="text/css">
.images{
	margin-top: 5px;
	 margin-left: auto;
     margin-right: auto;
}
.images img {
	height: 200px;
	width: 225px
  }

.trip-name{
font-size: 15px;
float: left;
}
.weather{
font-size: 10px;
float: center;
}

#save-button{
	float: right;
}
  </style>
{% endblock head %}
{% block content%}

	<div id='trip-info'>

		<div class='images'>
			<img id='img1' src="" alt="park image one" style="visibility:hidden">
			<img id='img2' src="" alt="park image two" style="visibility:hidden">
			<img id='img3'src="" alt="park image three" style="visibility:hidden">
			<img id='img4' src="" alt="park image four" style="visibility:hidden">
		</div>
		<div class='trip-name'>
			<h1 id='park-name'></h1>
			<h1 id='park-city-state'></h1>
		</div>
		<div class='weather'>
			<h1 id='avg-temp'></h1>
			<h1 id='min-temp'></h1>
			<h1 id='max-temp'></h1>
			<h1 id='avg-rain'></h1>
		</div>
		<br>
		<button type="submit" id="save-button" class="button button2" style="visibility:hidden">SAVE TRIP</button>
	</div>

	<h1 id='trip-name'></h1>


{% endblock content %}
{% block scripts %}
<script>
	
	let parks = "{{ parks }}";
	parks = parks.replaceAll("&#39;", "\'");
	parks = parks.replaceAll("&#34;", "\"");
	parks = parks.substr(1).slice(0, -1);
	parks = JSON.parse(parks);
	let month = "{{ month_input }}"
	
	parks.forEach(function (park){
		let popupText = `${park.park.name} <br> ${park.park.city}, ${park.park.state} <br> ${park.park.description}`
		let marker = new mapboxgl.Marker()
			.setLngLat([parseFloat(park.park.longitude),parseFloat(park.park.latitude)])
			.setPopup(new mapboxgl.Popup().setHTML(popupText))
			.addTo(map)
			map.flyTo({
			center: [parseFloat(park.park.longitude),parseFloat(park.park.latitude)]
			});

			marker.getElement().addEventListener('click', () => {
				//call fetch_data to get Park data, pictures, weather
				park_id = park.park.id
				// let trip = fetch_data(park_id,month)
				// console.log(trip)
				url = `http://127.0.0.1:5000/park_info/${park_id}/${month}` //api/db url here
				fetch(url)
					.then( (response) => {
						console.log(response) // logging response from the server
						// extract JSON
						return response.json()
					})
					.then( function(data) {
						console.log(data)
						let name = document.getElementById("park-name")
						name.innerHTML = JSON.stringify(data['park']['park_name']).replaceAll("\"","")

						let city_state = document.getElementById("park-city-state")
						city_state.innerHTML = JSON.stringify(data['park']['city'] + ', ' + data['park']['state']).replaceAll("\"","")

						let avg_temp = document.getElementById("avg-temp")
						avg_temp.innerHTML = `Average Temp: ${data['park']['avg_temp']} &#8457;`

						let max_temp = document.getElementById("max-temp")
						max_temp.innerHTML = `Max Temp: ${data['park']['max_temp']} &#8457;`

						let min_temp = document.getElementById("min-temp")
						min_temp.innerHTML = `Min Temp: ${data['park']['min_temp']} &#8457;`

						let avg_rain = document.getElementById("avg-rain")
						avg_rain.innerHTML = `Average Rainfall: ${ data['park']['precipiation']} inches`

						let image1URL = document.getElementById("img1")
						image1URL.style.visibility="visible"
						image1URL.src = data['park']['image_1'].replaceAll("\"","")

						let image2URL = document.getElementById("img2")
						image2URL.style.visibility="visible"
						image2URL.src = data['park']['image_2'].replaceAll("\"","")

						let image3URL = document.getElementById("img3")
						image3URL.style.visibility="visible"
						image3URL.src = data['park']['image_3'].replaceAll("\"","")

						let image4URL = document.getElementById("img4")
						image4URL.style.visibility="visible"
						image4URL.src = data['park']['image_4'].replaceAll("\"","")

						document.getElementById("save-button").style.visibility = "visible";

						document.getElementById("save-button").addEventListener('click', () => {
							trip_id = data['park']['trip_id']
							console.log(trip_id)
							url = `http://127.0.0.1:5000/saved_trip_info/${trip_id}/`
							fetch(url)
								.then( (response) => {
									console.log(response) // logging response from the server
									// extract JSON
									return response.json()
								})
								.then( function(data) {
									console.log(data)
									let parks_string = ""
									data.forEach(function (park){	
										parks_string = parks_string + "<br>" + park['park']['park_name'] 
									})
									let trip_name = document.getElementById("trip-name")
										trip_name.innerHTML = JSON.stringify(parks_string).replaceAll("\"","")
								})

						})

					}) //if issues connecting to API error displays
					.catch( error => {
						console.log(error)
						alert('ERROR, VIEW CONSOLE FOR MORE DETAILS')
					})
			
				})// end of event listener

        }) //end of for each
</script>
{% endblock scripts %}
